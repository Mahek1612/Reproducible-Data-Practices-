---
title: "Reproducible data practices"
author: "Mahek Shah"
date: "2024-05-17"
output: 
  html_document:
    toc: true
    toc_float:
      collapsed: true
      smooth_scroll: true
    theme: sandstone
    highlight: zenburn
    css: styles.css
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

This document covers broad information about good research practices while working with data. This has been created as a reference for the *Ohm lab @RPCCC*. The primary reference for this document is the **"Reproducible Research Practices"** workshop organized by **Alex's Lemonade Stand Foundation's Childhood Cancer Data Lab** on May 14-15, 2024. 

Other references:  
1. "Reproducibility and Replicability in Science." - https://www.ncbi.nlm.nih.gov/books/NBK547546/#
2. https://www.scribbr.com/methodology/reproducibility-repeatability-replicability/



## What is reproducibility? Why does it matter?

- Reproducibility means different things depending on the context. For us, in the context of bioinformatics and computational oncology, reproducibility means to provide enough information (data, code, methods, etc.) to allow someone to replicate the exact analysis and arrive at the same results. 

###### **Reproducibility crisis:**

- According to a study published in *Nature* in 2016, >70% researchers failed to reproduce someone else's work and >50% failed to reproduce their own work (Survey of ~1500 researchers).
- This leads to decreased reliability of pulished literature and causes distrust. 

![Cartoon "Scratch" from www.phdcomics.com](http://www.phdcomics.com/comics/archive/phd031214s.gif)


> Reproducibility = Obtaining the same results when using the **same** code, data and *conditions of analysis.*

- Reproducibility doesn't always mean that the analysis/result is correct! It just makes sure that the research is transparent. It is the minimum requirement for good data science. BUT this alone is not sufficient. 

```{r, echo=F, include=T}
library(cowplot)
library(ggplot2)

p1 <- ggdraw() + draw_image("https://media.springernature.com/w300/springer-static/image/art%3A10.1038%2F533452a/MediaObjects/41586_2016_BF533452a_Figg_HTML.jpg", scale = 1)
p2 <- ggdraw() + draw_image("https://media.springernature.com/w300/springer-static/image/art%3A10.1038%2F533452a/MediaObjects/41586_2016_BF533452a_Figh_HTML.jpg", scale = 1.2)

plot_grid(p1, p2)
```

###### **Bias as a barrier for reproducible research**

- Publication bias: 
- Information bias: 



> Replicability = Obtaining similar results across studies using **different data**. 


- A replicable study can show that the original study was reliable.  

- Together, reproducibility and replicability enhance the reliability of the results. It acts as a quality check and reduces bias. 


![Source: https://book.the-turing-way.org](https://book.the-turing-way.org/_images/reproducible-matrix.jpg)


## Project organization

Sources:
+ Vince Buffalo: (https://www.oreilly.com/library/view/bioinformatics-data-skills/9781449367480/)
+ Jenny Bryan: https://speakerdeck.com/jennybc/how-to-name-files    
+ Danielle Navarro: https://slides.djnavarro.net/project-structure   

### Why is organization important? 

It makes things easier to find. This is done by defining a standard and making the organization more predictable. 
  
  
### Best practices when organizing a project:

* Use a lot of folders and directories.
* Keeps projects separated and keep sections within a project separate.
* Basic folders: analyses, data, plots, reports, scripts


#### Data Folder
* Only big files go here! which are used repeatedly
* Raw - usually from external sources. Try not to modify this. Can change settings to make it unmodifiable
* Separate subfolders for processed files.
* Use subdirectories by processing stage, date, sample.
    

> *It is often easiest to process all the things in a folder together; organize by units of work*
    
#### Naming files! 

Make it informative.Should know what it is even without opening (*preferably!*)
* Jenny Bryan’s standard:
+ **Machine friendly :** 
  1. Avoid spaces (use underscores or dashes) 
  2. Use standard characters (letters, numbers, underscores and dashes; Periods only for file extensions; avoid using special characters) 
  3. Be consistent with case!!! (dont have 2 files with same name differing except in case - may/may not have meaning)
              
+ **Human friendly :** 
  1. Use long descriptive names (short names can be tempting) - to be able to know what each file is without opening!

+ **Sortable :** 
  1. Use number for sorting. Use 01, 02 (left pad). 
  2. Use ISO standard dates (year-month-date) which is easier for sorting
          
+ **Computable :** 
  1. Have multiple chunks in file names - separate with underscores. This allows the use of wildcards (*) all files that start or end with specific characters.
  2. For files from someone else - It is usually not advisable to rename them because the original names are easier to track in conversation. *When renaming :* Use scripts to track the changes made. Only rename when absolutely necessary!!!


## Strategies for Data Sharing

- data  = all information to remake, interpret or use any figure, table, etc. i.e code(versions, specific commands ran, code for preprocessing, post processing, visualization), metadata (about the sequencing and all the samples), documentation, data (raw, processed).
- 
- Coordinate with code and maintain records of all scripts, even if it is analyzed by the core
- Maintain both raw and processed data and deposit them at repositories.
- Be mindful of patient privacy when working with human subjects’ data.
- Documentation:: Contextual information  - description of the data, what each column name means. what does NA means? Origin of the data, software used to prepare it?


### Increases reliability

- Using a data repository: unique identifiers which can be cited, has policies for long-term retention, data sharing policies.
- Choosing repositories - generaalist or specialist, raw or processed data
- Complementary sharing avenues - lab/university server, Github, Zenodo (used with github)
- Considerations::
    - accessible considerations.  - ?
    - Interoperable - plain text files>>>> special formats (Excel, Matlab), use ontologies to obtain shared vocab - use hierachial graph; Eg: T-cells - not descriptive enough! Use a specific ontology term (specific type of T-cell)
    
- Reusable considerations

> Make a plan/lab-wide policy and stick to it! Naming, organizing, sharing data files and how will you store/backup data



### Organizing code in scripts and notebooks

- Read and use style guides::

https://style.tidyverse.org/

- Important style points to think about:
    - Variable and function name
    - indentation and spacing - tabs vs spaces, space before and after brackets & =
    - commenting style
- Comments are for the future you and collaborators. Explain why you are doing what you are doing!

> When updating code, remebmer to update comments too.

- Set-up and use R projects whenever applicable!






## Managing packages and environment. 

- Changes occur at all levels - scripts, packages, individual programs, OS, hardware!
- For the analysis layer - we are using Git and GitHub. - use “tags” and “releases” on GitHub - read more
- For package layer - changes in versions can affect the analysis, dependencies may require specific versions of packages. use sessionInfo() in R or sessioninfo::session_info()
- Using the same versions of the packages:
    - renv R package! - tracks, freezes and shares R encireonments
    - Each project can have its own environment with its own set of packages
    - doesnt use system R package library - creates library for each packages, but in an optimized way.
    - create renv.lock() file to describe the library.











Github Cheat sheet 


![Git](https://training.github.com/downloads/github-git-cheat-sheet.pdf)



![Git cheat sheet](https://res.cloudinary.com/practicaldev/image/fetch/s--Zib71Fgv--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/n082uxea33j6zq3mca7u.png)



